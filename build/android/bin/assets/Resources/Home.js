var MapModule=require("ti.map");Ti.include("adv1.js");getUserData();
var win1=Ti.UI.createWindow({backgroundColor:"white",top:"8%",left:140,width:"100%",height:"84%",exitOnClose:!0}),longi=75.75,lati=22.86,bridge=MapModule.createAnnotation({latitude:lati,longitude:longi,pincolor:MapModule.ANNOTATION_ROSE,leftView:Ti.UI.createButton({title:"Detail"}),rightButton:"/android/appicon.png",title:"hello abc",subtitle:"Have a good day"}),map1=MapModule.createView({userLocationButton:!0,regionFit:!0,mapType:MapModule.NORMAL_TYPE,animate:!0,region:{latitude:lati,longitude:longi,
latitudeDelta:15,longitudeDelta:15},height:"100%",top:0,left:0,width:"100%"}),view01=Ti.UI.createView({top:0,left:0,width:"100%",height:"100%",backgroundColor:"darkgray"});view01.add(map1);
var button02=Titanium.UI.createButton({title:"<<",backgroundColor:"#008B8B",top:0,left:0,color:"#ffffff",font:{fontSize:"20%",fontWeight:"bold"},height:"8.6%",width:140,id:"Custom Button1"}),button01=Titanium.UI.createButton({title:">>",backgroundColor:"#008B8B",top:0,left:0,color:"#ffffff",font:{fontSize:"20%",fontWeight:"bold"},height:"100%",width:140,id:"Custom Button2"}),test=0,win4=Ti.UI.createWindow({top:60,right:0,width:100,height:0,backgroundColor:"darkgray"}),imageContainer=Ti.UI.createView({top:"0%",
right:"2%",height:"100%",width:"40%",bottom:"2%"}),image03=Titanium.UI.createImageView({image:"images/Blankprofile.jpg",url:"",right:"1%",top:"1%",height:"95%",width:"40%"});imageContainer.add(image03);var fg=0;image03.addEventListener("click",function(){(new (require("modalWindow").modalWin)).open()});
var image04=Ti.App.Properties.getString("a"),label33=Titanium.UI.createLabel({text:"",textAlign:"center",left:"30%",color:"#ffffff",font:{fontSize:"20%",fontWeight:"bold"},top:0,height:"100%",width:"40%"}),h,win2=Ti.UI.createWindow({top:0,left:0,width:140,height:"92%",backgroundColor:"darkgray",exitOnClose:!0}),flag=0;function create(){flag=1}
for(var singleValue=["fullName"],multiValue=["phone"],people=Ti.Contacts.getAllPeople(),contact=[],name=[],j=0,i=0,ilen=people.length;i<ilen;i++){var person=people[i];JSON.stringify(person[multiValue[0]])=="{}"?i++:(name[j]=person.fullname,contact[j]=person.phone.mobile,j++)}
var json,resData="",i=j=0,row1,friendscontacts=[],friends=[],friendslatitude=[],friendslongitude=[],friendpropic=[],group=[],count1=0,count0=0,mainflag=1,MyData=contact.toString(),url="http://www.visitindia.com/PeopleTracker/CheckContacts.php?mobilenumbers="+MyData,client=Ti.Network.createHTTPClient({onload:function(){resData=this.responseText;json=JSON.parse(this.responseText);for(j=0;j<json.length;j++)row1=json[j],friends[i]=row1.FullName,friendscontacts[i]=row1.mobile,friendslatitude[i]=row1.Latitude,
friendslongitude[i]=row1.Longitude,friendpropic[i]=row1.ProfilePic,row1.Longitude>15?(group[i]=1,count1++):(group[i]=0,count0++),i++;mainflag=count0>count1?0:1;create()},onerror:function(a){Ti.API.debug(a.error)},timeout:5E3});client.open("GET",url);client.send();
var win3=Ti.UI.createWindow({top:0,width:"100%",height:"8%",backgroundColor:"#008B8B",exitOnClose:!0}),button03=Titanium.UI.createButton({title:"take photo",backgroundColor:"#1874CD",top:65,right:5,height:50,width:90,id:"Custom Button"}),button04=Titanium.UI.createButton({title:"upload photo",backgroundColor:"#1874CD",top:125,right:5,height:50,width:90,id:"Custom Button"}),button05=Titanium.UI.createButton({title:"remove image",backgroundColor:"#1874CD",top:185,right:5,height:50,width:90,id:"Custom Button"});
button03.addEventListener("click",function(){Titanium.Media.showCamera({success:function(a){var a=a.media,b=Titanium.Filesystem.getFile(Titanium.Filesystem.applicationDataDirectory,"camera_photo.png");b.write(a);win4.backgroundImage=b.nativePath;a={file:b.read(),name:"camera_photo.png"};xhr=Titanium.Network.createHTTPClient();xhr.open("POST","http://www.visitindia.com/PeopleTracker/UploadPic.php");xhr.setRequestHeader("contentType","multipart/form-data");xhr.send(a);xhr.onload=function(){textfield.value=
this.responseText;Ti.API.info(this.responseText)}},cancel:function(){},error:function(a){var b=Titanium.UI.createAlertDialog({title:"Camera"});a.code==Titanium.Media.NO_CAMERA?b.setMessage("Device does not have video recording capabilities"):b.setMessage("Unexpected error: "+a.code);b.show()}})});
button04.addEventListener("click",function(){Titanium.Media.openPhotoGallery({success:function(a){var b=Titanium.Network.createHTTPClient();b.onload=function(){Ti.UI.createAlertDialog({title:"Success",message:"status code "+this.status}).show()};b.open("POST","https://myserver.com/api/uploadAndPost.do");b.send({theImage:a.media,username:"foo",password:"bar"})}});fg=1});
button02.addEventListener("click",function(){var a=Ti.UI.createAnimation({left:0,width:0,height:"92%",duration:500}),b=Ti.UI.createAnimation({top:"8%",left:0,height:"84%",width:"100%",duration:500});win1.animate(b);win2.animate(a)});button01.addEventListener("click",function(){var a=Ti.UI.createAnimation({left:0,top:0,width:140,height:"92%",duration:500}),b=Ti.UI.createAnimation({top:"8%",left:140,height:"84%",width:"100%",duration:500});win1.animate(b);win2.animate(a)});
var label01=Titanium.UI.createLabel({text:"View My Friends",textAlign:"center",top:5,left:10,width:120,height:90,backgroundColor:"darkgray"}),label02=Titanium.UI.createLabel({text:"View All Friends",textAlign:"center",top:5,left:10,width:120,height:90,backgroundColor:"darkgray"}),label03=Titanium.UI.createLabel({text:"My Location",textAlign:"center",top:5,left:10,width:120,height:90,backgroundColor:"darkgray"}),label04=Titanium.UI.createLabel({text:"Find Path to a Place",textAlign:"center",top:5,
left:10,width:120,height:90,backgroundColor:"darkgray"}),label05=Titanium.UI.createLabel({text:"Find Path to a Friend",textAlign:"center",top:5,left:10,width:120,height:90,backgroundColor:"darkgray"}),label06=Titanium.UI.createLabel({text:"Invite Friends",textAlign:"center",top:5,left:10,width:120,height:90,backgroundColor:"darkgray"}),label07=Titanium.UI.createLabel({text:"Log Out",textAlign:"center",top:5,left:10,width:120,height:90,backgroundColor:"darkgray"}),leftView=Titanium.UI.createView({backgroundColor:"white",
width:"100",height:"100",top:0,left:0}),viewImage=Titanium.UI.createImageView({image:"images/Blankprofile.jpg",url:"",right:"1%",top:"1%",height:"50",width:"50"});leftView.add(viewImage);label01.addEventListener("click",function(){if(JSON.parse(resData).length==0)alert("Your friends not registered with us !!!");else{var a=Ti.UI.createWindow({url:"FriendList.js"});flag==1&&(Ti.App.Properties.setString("value",resData),a.open())}});var mview,thenum;
label02.addEventListener("click",function(){if(JSON.parse(resData).length==0)alert("Your friends not registered with us !!!");else{test=1;var a=0,b=0,c=0,d,f,e,g=0;for(i=0;i<friends.length;i++)group[i]==mainflag&&(e=friendslatitude[i]*Math.PI/180,f=friendslongitude[i]*Math.PI/180,d=Math.cos(e)*Math.cos(f),f=Math.cos(e)*Math.sin(f),e=Math.sin(e),a+=d,b+=f,c+=e,g++);a/=g;b/=g;c/=g;d=Math.atan2(b,a);a=Math.sqrt(a*a+b*b);c=Math.atan2(c,a);c=c*180/Math.PI;d=d*180/Math.PI;if(flag==1){map1.removeAllAnnotations();
map1.region={latitude:c,longitude:d,latitudeDelta:30,longitudeDelta:30};for(i=0;i<friends.length;i++)thenum=friendscontacts[i],mview=MapModule.createAnnotation({latitude:friendslatitude[i],longitude:friendslongitude[i],title:friends[i],pincolor:MapModule.ANNOTATION_VIOLET,leftButton:friendpropic[i],rightButton:"images/call.png",myid:thenum}),map1.addAnnotation(mview),map1.addEventListener("click",function(a){a.clicksource=="rightPane"&&Ti.Platform.openURL("tel:"+a.annotation.myid)})}}});
label03.addEventListener("click",function(){test=0;getMyLocation()});label04.addEventListener("click",function(){var a=Ti.UI.createWindow({url:"PathToPlace.js"});flag==1&&a.open()});label05.addEventListener("click",function(){Ti.App.Properties.setString("myLatLong",lati+","+longi);var a=Ti.UI.createWindow({url:"PathToFriend.js"});flag==1&&(Ti.App.Properties.setString("value",resData),a.open())});label06.addEventListener("click",function(){alert("Coming Soon")});
label07.addEventListener("click",function(){Titanium.App.Properties.removeProperty("MobileNumber");Ti.UI.createWindow({url:"LoginWindow.js"}).open()});
var row01=Ti.UI.createView({backgroundColor:"darkgray",borderColor:"#bbb",borderWidth:1,width:140,height:100,top:0,left:0}),row02=Ti.UI.createView({backgroundColor:"darkgray",borderColor:"#bbb",borderWidth:1,width:140,height:100,top:0,left:0}),row03=Ti.UI.createView({backgroundColor:"darkgray",borderColor:"#bbb",borderWidth:1,width:140,height:100,top:0,left:0}),row04=Ti.UI.createView({backgroundColor:"darkgray",borderColor:"#bbb",borderWidth:1,width:140,height:100,top:0,left:0}),row05=Ti.UI.createView({backgroundColor:"darkgray",
borderColor:"#bbb",borderWidth:1,width:140,height:100,top:0,left:0}),row06=Ti.UI.createView({backgroundColor:"darkgray",borderColor:"#bbb",borderWidth:1,width:140,height:100,top:0,left:0}),row07=Ti.UI.createView({backgroundColor:"darkgray",borderColor:"#bbb",borderWidth:1,width:140,height:100,top:0,left:0});row01.add(label01);row02.add(label02);row03.add(label03);row04.add(label04);row05.add(label05);row06.add(label06);row07.add(label07);
var scrollView=Ti.UI.createScrollView({top:"8.6%",width:140,height:"86%",contentHeight:"auto",layout:"vertical"});scrollView.add(row01);scrollView.add(row02);scrollView.add(row03);scrollView.add(row04);scrollView.add(row05);scrollView.add(row06);scrollView.add(row07);var advWin5=Ti.UI.createWindow({backgroundColor:"#008B8B",left:0,width:"100%",height:"8%",bottom:"0%",exitOnClose:!0}),advLabel=Ti.UI.createLabel({text:"",color:"#ffffff",height:"100%",width:"100%",textAlign:"center",top:"10%"});advWin5.add(advLabel);
advLabel.addEventListener("click",function(){Ti.Platform.openURL(adLink)});win1.add(view01);win3.add(button01);win3.add(imageContainer);win3.add(label33);win2.add(scrollView);win2.add(button02);win3.open();advWin5.open();win1.open();win2.open();Ti.App.addEventListener("updateImage",function(a){image03.image=a.imageData});var MyUserName="",UserProPic="";
function getUserData(){var a=Titanium.App.Properties.getString("MobileNumber");if(a!=null||a!=""){var a="http://www.visitindia.com/PeopleTracker/GetUserData.php?mobilenumber="+a,b="",c="",d=Ti.Network.createHTTPClient({onload:function(){b=JSON.parse(this.responseText);c=b[0];var a=c.FullName,d=c.ProfilePic;MyUserName=a;UserProPic=d;Titanium.App.Properties.setString("UserName",a);label33.text="Welcome "+a;image03.image=d},onerror:function(){},timeout:5E3});d.open("GET",a);d.send()}else Ti.UI.createWindow({backgroundColor:"#000000",
title:"Test 000",url:"app.js"}).open()}var intent;function StartService(){Ti.Android.isServiceRunning(Ti.Android.createServiceIntent({url:"gpsservice.js"}))||(intent=Ti.Android.createServiceIntent({url:"gpsservice.js"}),intent.putExtra("interval",3E5),Ti.Android.startService(intent))}StartService();Ti.App.addEventListener("gps_service_fire",function(){});getMyLocation();
function getMyLocation(){function a(a){!a.success||a.error?(alert("Unable to get your location."),Ti.API.debug(JSON.stringify(a)),Ti.API.debug(a)):Ti.App.fireEvent("app:got.location",{coords:a.coords})}Ti.App.GeoApp={};Ti.Geolocation.preferredProvider=Titanium.Geolocation.PROVIDER_GPS;Ti.Geolocation.purpose="testing";Titanium.Geolocation.accuracy=Titanium.Geolocation.ACCURACY_BEST;Titanium.Geolocation.distanceFilter=10;Titanium.Geolocation.locationServicesEnabled===!1&&Ti.API.debug("Your device has GPS turned off. Please turn it on.");
Ti.App.addEventListener("app:got.location",function(b){Ti.App.GeoApp.f_lng=b.longitude;Ti.App.GeoApp.f_lat=b.latitude;Ti.API.debug(JSON.stringify(b));Ti.Geolocation.removeEventListener("location",a);var c=b.coords.latitude,b=b.coords.longitude;map1.removeAllAnnotations();map1.region={latitude:c,longitude:b,latitudeDelta:2,longitudeDelta:2};mview=MapModule.createAnnotation({latitude:c,longitude:b,pincolor:MapModule.ANNOTATION_ROSE,title:MyUserName,leftButton:UserProPic});map1.addAnnotation(mview);
updateUserGPS(c,b)});Titanium.Geolocation.getCurrentPosition(a);Titanium.Geolocation.addEventListener("location",a)}function updateUserGPS(a,b){var c="http://www.visitindia.com/PeopleTracker/UpdateGps.php?mno="+Titanium.App.Properties.getString("MobileNumber")+"&longi="+b+"&lati="+a,d=Ti.Network.createHTTPClient({onload:function(){},onerror:function(a){Ti.API.debug(a.error)},timeout:5E3});d.open("GET",c);d.send()};
